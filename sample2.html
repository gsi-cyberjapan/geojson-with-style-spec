<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>スタイルつき GeoJSON 表示サンプル</title>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<style>
body {padding: 0; margin: 0}
html, body, #mapdiv {height: 100%; width: 100%;}
.leaflet-container {background: #fff;}
.leaflet-div-icon {background: none;white-space: nowrap;border:none;}
</style>
</head>
<body>
<div id="mapdiv">
<script>

function geojson_style(prop) {
  var s = {};
  for(name in prop) {
   if(name.match(/^_/) && !name.match(/_markerType/)){
    if( prop['_markerType']=='Circle' && name =='_radius'){continue;}
    s[name.substr(1)]=prop[name];
   }
  }
  return s;
}

function popup_properties(prop) {
  var s = ''
  for(name in prop) {
   if(!name.match(/^_/)){
    s += name + "：" + prop[name] + "<br>";
   }
  }
  return s;
}

//スタイルつき GeoJSON記載
var sampledata = 
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "name": "サンプルアイコン1",
        "サンプル": "アイコン1",
        "_markerType": "Icon",
        "_iconUrl": "http://cyberjapandata.gsi.go.jp/portal/sys/v4/symbols/080.png",
        "_iconSize": [
          20,
          20
        ],
        "_iconAnchor": [
          10,
          10
        ]
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.08612275123596,
          36.10531502504233
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "サンプルアイコン2",
        "サンプル": "アイコン2",
        "_markerType": "Icon",
        "_iconUrl": "http://cyberjapandata.gsi.go.jp/portal/sys/v4/symbols/081.png",
        "_iconSize": [
          20,
          20
        ],
        "_iconAnchor": [
          10,
          10
        ]
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.08683621883392,
          36.10496396197309
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "サンプルライン1",
        "サンプル": "ライン1",
        "_color": "#ff0000",
        "_opacity": 0.5,
        "_weight": 3
      },
      "geometry": {
        "type": "LineString",
        "coordinates": [
          [
            140.08261442184445,
            36.107178666916624
          ],
          [
            140.08456707000732,
            36.103954105137895
          ],
          [
            140.0870132446289,
            36.10280987398104
          ],
          [
            140.08703470230103,
            36.10237644873644
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "サンプルライン2",
        "サンプル": "ライン2",
        "_color": "#0000ff",
        "_opacity": 0.71,
        "_weight": 5
      },
      "geometry": {
        "type": "LineString",
        "coordinates": [
          [
            140.08817195892334,
            36.105774438540784
          ],
          [
            140.08583307266235,
            36.10306992798007
          ],
          [
            140.089373588562,
            36.10352068620589
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "サンプルポリゴン1",
        "サンプル": "ポリゴン1",
        "_color": "#000000",
        "_opacity": 0.5,
        "_weight": 3,
        "_fillColor": "#ff0000",
        "_fillOpacity": 0.5
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              140.08302211761475,
              36.10438752167874
            ],
            [
              140.08130550384521,
              36.102463133976656
            ],
            [
              140.08551120758057,
              36.1007294110001
            ],
            [
              140.08536100387573,
              36.10254981912122
            ],
            [
              140.08302211761475,
              36.10438752167874
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "サンプルポリゴン2",
        "サンプル": "ポリゴン2",
        "_color": "#00ff00",
        "_opacity": 0.8,
        "_weight": 3,
        "_fillColor": "#ffff00",
        "_fillOpacity": 0.8
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              140.08748531341553,
              36.102601830162044
            ],
            [
              140.0864553451538,
              36.10152692832089
            ],
            [
              140.09006023406982,
              36.10183899811237
            ],
            [
              140.08748531341553,
              36.102601830162044
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "サンプルサークル1",
        "サンプル": "サークル1",
        "_markerType": "Circle",
        "_color": "#000000",
        "_opacity": 0.5,
        "_weight": 3,
        "_fillColor": "#ff0000",
        "_fillOpacity": 0.5,
        "_radius": 80
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.08682012557983,
          36.10554906621689
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "サンプルサークル2",
        "サンプル": "サークル2",
        "_markerType": "Circle",
        "_color": "#0000ff",
        "_opacity": 0.81,
        "_weight": 3,
        "_fillColor": "#00ffff",
        "_fillOpacity": 0.81,
        "_radius": 160
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.08877277374268,
          36.103988778549166
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "サンプルサークルマーカー1",
        "サンプル": "サークルマーカー1",
        "_markerType": "CircleMarker",
        "_color": "#000000",
        "_opacity": 0.5,
        "_weight": 3,
        "_fillColor": "#ff0000",
        "_fillOpacity": 0.5,
        "_radius": 20
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.0909,
          36.10555
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "サンプルサークルマーカー2",
        "サンプル": "サークルマーカー2",
        "_markerType": "CircleMarker",
        "_color": "#0000ff",
        "_opacity": 0.81,
        "_weight": 3,
        "_fillColor": "#00ffff",
        "_fillOpacity": 0.81,
        "_radius": 40
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.09077,
          36.103980
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "サンプルdiv1",
        "サンプル": "div1",
        "_markerType": "DivIcon",
        "_html": "サンプルdiv1"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.08079051971436,
          36.104907618371435
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "サンプルdiv2",
        "サンプル": "div2",
        "_markerType": "DivIcon",
        "_html": "サンプルdiv2"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.08606910705566,
          36.10280987398104
        ]
      }
    }
  ]
};

//スタイルつき GeoJSON読み込み
var sampleLayer = L.geoJson(sampledata, {
   pointToLayer: function (feature, latlng) {
    var s = geojson_style(feature.properties);
    if(feature.properties['_markerType']=='Icon'){
         var myIcon = L.icon(s);
         return L.marker(latlng, {icon: myIcon});
    }
    if(feature.properties['_markerType']=='DivIcon'){
         var myIcon = L.divIcon(s);
         return L.marker(latlng, {icon: myIcon});
    }
    if(feature.properties['_markerType']=='Circle'){
        return L.circle(latlng,feature.properties['_radius'],s);
    }
    if(feature.properties['_markerType']=='CircleMarker'){
        return L.circleMarker(latlng,s);
    }
   },
   style: function (feature) {
     if(!feature.properties['_markerType']){
        var s = geojson_style(feature.properties);
        return s;
     }
   },
   onEachFeature: function (feature, layer) {
    layer.bindPopup(popup_properties(feature.properties));
   }
});

//背景地図設定
var std = L.tileLayer(
'http://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png',
{attribution: "<a href='http://maps.gsi.go.jp/development/ichiran.html' target='_blank'>地理院タイル（標準地図）</a>", 
maxNativeZoom: 18, maxZoom: 18, opacity:1});

var map = L.map('mapdiv', {
center: [36.104700,140.087013], zoom: 16, layers: [std,sampleLayer]});

L.control.scale({imperial: false}).addTo(map);
var baseLayers = {"地理院タイル（標準地図）": std};
var overlays = {'サンプル': sampleLayer };
L.control.layers(baseLayers, overlays,{position:'topright',collapsed:false}).addTo(map);


</script>
</body>
</html>
