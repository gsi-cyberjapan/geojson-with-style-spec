<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>スタイルつき GeoJSON 表示サンプル</title>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>

<style>
  body {padding: 0; margin: 0}
  html, body, #mapdiv {height: 100%; width: 100%;}
  .leaflet-container {background: #fff;}
  .leaflet-div-icon {background: none;white-space: nowrap;border:none;}
</style>
</head>


<body>
<div id="mapdiv">
<script>
function geojson_style(prop) {
  var s = {};
  for(name in prop) {
    if(name.match(/^_/) && !name.match(/_markerType/)){
      if( prop['_markerType']=='Circle' && name =='_radius'){continue;}
      s[name.substr(1)]=prop[name];
    }
  }
  return s;
}

function popup_properties(prop) {
  var s = ''
  for(name in prop) {
    if(!name.match(/^_/)){
      s += name + "：" + prop[name] + "<br>";
    }
  }
  return s;
}

// スタイルつき GeoJSONを「var sampledata = 」に続けて記載
// 末尾の「}」の直後に「;」が必要
var sampledata = 
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "name": "マーカー（アイコン） その1",
        "geometryのtype": "Point",
        "propertiesの_markertype": "Icon",
        "_markerType": "Icon",
        "_iconUrl": "http://cyberjapandata.gsi.go.jp/portal/sys/v4/symbols/081.png",
        "_iconSize": [
          20,
          20
        ],
        "_iconAnchor": [
          10,
          10
        ]
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.0814127922058,
          36.09984519755111
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "マーカー（アイコン） その2",
        "geometryのtype": "Point",
        "propertiesの_markertype": "Icon",
        "_markerType": "Icon",
        "_iconUrl": "http://cyberjapandata.gsi.go.jp/portal/sys/v4/symbols/081.png",
        "_iconSize": [
          20,
          20
        ],
        "_iconAnchor": [
          10,
          10
        ]
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.08042573928833,
          36.10003591109742
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "マーカー（円） その1",
        "geometryのtype": "Icon",
        "propertiesの_markertype": "CircleMarker",
        "_markerType": "CircleMarker",
        "_color": "#000000",
        "_opacity": 0.5,
        "_weight": 3,
        "_fillColor": "#9900ff",
        "_fillOpacity": 0.5,
        "_radius": 20
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.07870912551877,
          36.10029597427826
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "マーカー（円） その2",
        "geometryのtype": "Icon",
        "propertiesの_markertype": "CircleMarker",
        "_markerType": "CircleMarker",
        "_color": "#000000",
        "_opacity": 0.5,
        "_weight": 3,
        "_fillColor": "#9900ff",
        "_fillOpacity": 0.5,
        "_radius": 20
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.0771427154541,
          36.10071207357713
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "線 その1",
        "geometryのtype": "LineString",
        "_color": "#ff00ff",
        "_opacity": 0.5,
        "_weight": 5
      },
      "geometry": {
        "type": "LineString",
        "coordinates": [
          [
            140.07656335830688,
            36.09972383414425
          ],
          [
            140.07913827896118,
            36.09922104089022
          ],
          [
            140.07988929748535,
            36.10137089296031
          ],
          [
            140.0844168663025,
            36.10105882130955
          ],
          [
            140.08684158325195,
            36.103000580331155
          ],
          [
            140.0914978981018,
            36.10289655874302
          ],
          [
            140.09100437164307,
            36.10554906621689
          ],
          [
            140.0870132446289,
            36.10716133091688
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "線 その2",
        "geometryのtype": "LineString",
        "_color": "#0000ff",
        "_opacity": 0.75,
        "_weight": 5
      },
      "geometry": {
        "type": "LineString",
        "coordinates": [
          [
            140.0760054588318,
            36.09847551393631
          ],
          [
            140.08046865463257,
            36.09812875480343
          ],
          [
            140.0835156440735,
            36.09738321748593
          ],
          [
            140.08619785308838,
            36.09700177705334
          ],
          [
            140.08613348007202,
            36.0987009065521
          ],
          [
            140.0863265991211,
            36.09889162287585
          ],
          [
            140.0844168663025,
            36.09977584705585
          ],
          [
            140.0864553451538,
            36.10029597427826
          ],
          [
            140.08907318115234,
            36.10253248209996
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "ポリゴン その1",
        "geometryのtype": "Polygon",
        "_color": "#000000",
        "_opacity": 0.6,
        "_weight": 3,
        "_fillColor": "#00ff00",
        "_fillOpacity": 0.5
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              140.08535027503967,
              36.10580044299809
            ],
            [
              140.08815050125122,
              36.105809111148616
            ],
            [
              140.08893907070157,
              36.10358136500031
            ],
            [
              140.08613884449005,
              36.10359003339569
            ],
            [
              140.08535027503967,
              36.10580044299809
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "ポリゴン その2",
        "geometryのtype": "Polygon",
        "_color": "#000000",
        "_opacity": 0.6,
        "_weight": 3,
        "_fillColor": "#00ff00",
        "_fillOpacity": 0.5
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              140.0810346007347,
              36.10577011193364
            ],
            [
              140.08383482694626,
              36.105778780084165
            ],
            [
              140.0846233963966,
              36.10355103393586
            ],
            [
              140.0818231701851,
              36.10355970233124
            ],
            [
              140.0810346007347,
              36.10577011193364
            ]
          ]
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "円 その1",
        "geometryのtype": "Point",
        "propertiesの_markertype": "Circle",
        "_markerType": "Circle",
        "_color": "#000000",
        "_opacity": 0.5,
        "_weight": 3,
        "_fillColor": "#ff0000",
        "_fillOpacity": 0.5,
        "_radius": 100
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.07606983184814,
          36.10645055163299
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "円 その2",
        "geometryのtype": "Point",
        "propertiesの_markertype": "Circle",
        "_markerType": "Circle",
        "_color": "#000000",
        "_opacity": 0.5,
        "_weight": 3,
        "_fillColor": "#ff0000",
        "_fillOpacity": 0.5,
        "_radius": 100
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.0779151916504,
          36.10457822419921
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "テキスト その1",
        "geometryのtype": "Point",
        "propertiesの_markertype": "DivIcon",
        "_markerType": "DivIcon",
        "_html": "<span style=\"color: #0000ff; font-weight: bold;\">これはテキストのサンプルです。</span>"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.07868766784668,
          36.102047043951366
        ]
      }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "テキスト その2",
        "geometryのtype": "Point",
        "propertiesの_markertype": "DivIcon",
        "_markerType": "DivIcon",
        "_html": "<span style=\"color: #0000ff; font-weight: bold;\">これはテキストのサンプルです。</span>"
      },
      "geometry": {
        "type": "Point",
        "coordinates": [
          140.0792670249939,
          36.10256715613866
        ]
      }
    }
  ]
};


//スタイルつき GeoJSON読み込み
var sampleLayer = L.geoJson(sampledata, {
  pointToLayer: function (feature, latlng) {
    var s = geojson_style(feature.properties);
    if(feature.properties['_markerType']=='Icon'){
      var myIcon = L.icon(s);
      return L.marker(latlng, {icon: myIcon});
    }
    if(feature.properties['_markerType']=='DivIcon'){
      var myIcon = L.divIcon(s);
      return L.marker(latlng, {icon: myIcon});
    }
    if(feature.properties['_markerType']=='Circle'){
      return L.circle(latlng,feature.properties['_radius'],s);
    }
    if(feature.properties['_markerType']=='CircleMarker'){
      return L.circleMarker(latlng,s);
    }
  },
  style: function (feature) {
    if(!feature.properties['_markerType']){
      var s = geojson_style(feature.properties);
      return s;
    }
  },
  onEachFeature: function (feature, layer) {
    layer.bindPopup(popup_properties(feature.properties));
  }
});


//背景地図設定
var std = L.tileLayer(
  'http://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png',
  {
    attribution: "<a href='http://maps.gsi.go.jp/development/ichiran.html' target='_blank'>地理院タイル（標準地図）</a>", 
    maxNativeZoom: 18,
    maxZoom: 18,
    opacity:1
  }
);

var map = L.map('mapdiv', {
  center: [36.104700,140.087013], zoom: 16, layers: [std,sampleLayer]
});

L.control.scale({imperial: false}).addTo(map);
var baseLayers = {"地理院タイル（標準地図）": std};
var overlays = {'サンプル': sampleLayer };
L.control.layers(baseLayers, overlays,{position:'topright',collapsed:false}).addTo(map);
</script>
</body>

</html>
